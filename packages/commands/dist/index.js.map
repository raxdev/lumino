{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["// Copyright (c) Jupyter Development Team.\r\n// Distributed under the terms of the Modified BSD License.\r\n/*-----------------------------------------------------------------------------\r\n| Copyright (c) 2014-2017, PhosphorJS Contributors\r\n|\r\n| Distributed under the terms of the BSD 3-Clause License.\r\n|\r\n| The full license is in the file LICENSE, distributed with this software.\r\n|----------------------------------------------------------------------------*/\r\nimport {\r\n  ArrayExt\r\n} from '@lumino/algorithm';\r\n\r\nimport {\r\n  JSONExt, ReadonlyJSONObject, ReadonlyPartialJSONObject\r\n} from '@lumino/coreutils';\r\n\r\nimport {\r\n  DisposableDelegate, IDisposable\r\n} from '@lumino/disposable';\r\n\r\nimport {\r\n  Platform, Selector\r\n} from '@lumino/domutils';\r\n\r\nimport {\r\n  getKeyboardLayout\r\n} from '@lumino/keyboard';\r\n\r\nimport {\r\n  ISignal, Signal\r\n} from '@lumino/signaling';\r\n\r\nimport {\r\n  VirtualElement\r\n} from '@lumino/virtualdom';\r\n\r\n/**\r\n * An object which manages a collection of commands.\r\n *\r\n * #### Notes\r\n * A command registry can be used to populate a variety of action-based\r\n * widgets, such as command palettes, menus, and toolbars.\r\n */\r\nexport\r\nclass CommandRegistry {\r\n  /**\r\n   * Construct a new command registry.\r\n   */\r\n  constructor() { }\r\n\r\n  /**\r\n   * A signal emitted when a command has changed.\r\n   *\r\n   * #### Notes\r\n   * This signal is useful for visual representations of commands which\r\n   * need to refresh when the state of a relevant command has changed.\r\n   */\r\n  get commandChanged(): ISignal<this, CommandRegistry.ICommandChangedArgs> {\r\n    return this._commandChanged;\r\n  }\r\n\r\n  /**\r\n   * A signal emitted when a command has executed.\r\n   *\r\n   * #### Notes\r\n   * Care should be taken when consuming this signal. The command system is used\r\n   * by many components for many user actions. Handlers registered with this\r\n   * signal must return quickly to ensure the overall application remains responsive.\r\n   */\r\n  get commandExecuted(): ISignal<this, CommandRegistry.ICommandExecutedArgs> {\r\n    return this._commandExecuted;\r\n  }\r\n\r\n  /**\r\n   * A signal emitted when a key binding is changed.\r\n   */\r\n  get keyBindingChanged(): ISignal<this, CommandRegistry.IKeyBindingChangedArgs> {\r\n    return this._keyBindingChanged;\r\n  }\r\n\r\n  /**\r\n   * A read-only array of the key bindings in the registry.\r\n   */\r\n  get keyBindings(): ReadonlyArray<CommandRegistry.IKeyBinding> {\r\n    return this._keyBindings;\r\n  }\r\n\r\n  /**\r\n   * List the ids of the registered commands.\r\n   *\r\n   * @returns A new array of the registered command ids.\r\n   */\r\n  listCommands(): string[] {\r\n    return Object.keys(this._commands);\r\n  }\r\n\r\n  /**\r\n   * Test whether a specific command is registered.\r\n   *\r\n   * @param id - The id of the command of interest.\r\n   *\r\n   * @returns `true` if the command is registered, `false` otherwise.\r\n   */\r\n  hasCommand(id: string): boolean {\r\n    return id in this._commands;\r\n  }\r\n\r\n  /**\r\n   * Add a command to the registry.\r\n   *\r\n   * @param id - The unique id of the command.\r\n   *\r\n   * @param options - The options for the command.\r\n   *\r\n   * @returns A disposable which will remove the command.\r\n   *\r\n   * @throws An error if the given `id` is already registered.\r\n   */\r\n  addCommand(id: string, options: CommandRegistry.ICommandOptions): IDisposable {\r\n    // Throw an error if the id is already registered.\r\n    if (id in this._commands) {\r\n      throw new Error(`Command '${id}' already registered.`);\r\n    }\r\n\r\n    // Add the command to the registry.\r\n    this._commands[id] = Private.createCommand(options);\r\n\r\n    // Emit the `commandChanged` signal.\r\n    this._commandChanged.emit({ id, type: 'added' });\r\n\r\n    // Return a disposable which will remove the command.\r\n    return new DisposableDelegate(() => {\r\n      // Remove the command from the registry.\r\n      delete this._commands[id];\r\n\r\n      // Emit the `commandChanged` signal.\r\n      this._commandChanged.emit({ id, type: 'removed' });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Notify listeners that the state of a command has changed.\r\n   *\r\n   * @param id - The id of the command which has changed. If more than\r\n   *   one command has changed, this argument should be omitted.\r\n   *\r\n   * @throws An error if the given `id` is not registered.\r\n   *\r\n   * #### Notes\r\n   * This method should be called by the command author whenever the\r\n   * application state changes such that the results of the command\r\n   * metadata functions may have changed.\r\n   *\r\n   * This will cause the `commandChanged` signal to be emitted.\r\n   */\r\n  notifyCommandChanged(id?: string): void {\r\n    if (id !== undefined && !(id in this._commands)) {\r\n      throw new Error(`Command '${id}' is not registered.`);\r\n    }\r\n    this._commandChanged.emit({ id, type: id ? 'changed' : 'many-changed' });\r\n  }\r\n\r\n  /**\r\n   * Get the display label for a specific command.\r\n   *\r\n   * @param id - The id of the command of interest.\r\n   *\r\n   * @param args - The arguments for the command.\r\n   *\r\n   * @returns The display label for the command, or an empty string\r\n   *   if the command is not registered.\r\n   */\r\n  label(id: string, args: ReadonlyPartialJSONObject = JSONExt.emptyObject): string {\r\n    let cmd = this._commands[id];\r\n    return cmd ? cmd.label.call(undefined, args) : '';\r\n  }\r\n\r\n  /**\r\n   * Get the mnemonic index for a specific command.\r\n   *\r\n   * @param id - The id of the command of interest.\r\n   *\r\n   * @param args - The arguments for the command.\r\n   *\r\n   * @returns The mnemonic index for the command, or `-1` if the\r\n   *   command is not registered.\r\n   */\r\n  mnemonic(id: string, args: ReadonlyPartialJSONObject = JSONExt.emptyObject): number {\r\n    let cmd = this._commands[id];\r\n    return cmd ? cmd.mnemonic.call(undefined, args) : -1;\r\n  }\r\n\r\n  /**\r\n   * Get the icon renderer for a specific command.\r\n   *\r\n   * DEPRECATED: if set to a string value, the .icon field will\r\n   * function as an alias for the .iconClass field, for backwards\r\n   * compatibility. In the future when this is removed, the default\r\n   * return type will become undefined.\r\n   *\r\n   * @param id - The id of the command of interest.\r\n   *\r\n   * @param args - The arguments for the command.\r\n   *\r\n   * @returns The icon renderer for the command, or\r\n   *   an empty string if the command is not registered.\r\n   */\r\n  icon(id: string, args: ReadonlyPartialJSONObject = JSONExt.emptyObject): VirtualElement.IRenderer | undefined\r\n  /* <DEPRECATED> */ | string /* </DEPRECATED> */\r\n  {\r\n    let cmd = this._commands[id];\r\n    return cmd ? cmd.icon.call(undefined, args) : /* <DEPRECATED> */ '' /* </DEPRECATED> */ /* <FUTURE> undefined </FUTURE> */;\r\n  }\r\n\r\n  /**\r\n   * Get the icon class for a specific command.\r\n   *\r\n   * @param id - The id of the command of interest.\r\n   *\r\n   * @param args - The arguments for the command.\r\n   *\r\n   * @returns The icon class for the command, or an empty string if\r\n   *   the command is not registered.\r\n   */\r\n  iconClass(id: string, args: ReadonlyPartialJSONObject = JSONExt.emptyObject): string {\r\n    let cmd = this._commands[id];\r\n    return cmd ? cmd.iconClass.call(undefined, args) : '';\r\n  }\r\n\r\n  /**\r\n   * Get the icon label for a specific command.\r\n   *\r\n   * @param id - The id of the command of interest.\r\n   *\r\n   * @param args - The arguments for the command.\r\n   *\r\n   * @returns The icon label for the command, or an empty string if\r\n   *   the command is not registered.\r\n   */\r\n  iconLabel(id: string, args: ReadonlyPartialJSONObject = JSONExt.emptyObject): string {\r\n    let cmd = this._commands[id];\r\n    return cmd ? cmd.iconLabel.call(undefined, args) : '';\r\n  }\r\n\r\n  /**\r\n   * Get the short form caption for a specific command.\r\n   *\r\n   * @param id - The id of the command of interest.\r\n   *\r\n   * @param args - The arguments for the command.\r\n   *\r\n   * @returns The caption for the command, or an empty string if the\r\n   *   command is not registered.\r\n   */\r\n  caption(id: string, args: ReadonlyPartialJSONObject = JSONExt.emptyObject): string {\r\n    let cmd = this._commands[id];\r\n    return cmd ? cmd.caption.call(undefined, args) : '';\r\n  }\r\n\r\n  /**\r\n   * Get the usage help text for a specific command.\r\n   *\r\n   * @param id - The id of the command of interest.\r\n   *\r\n   * @param args - The arguments for the command.\r\n   *\r\n   * @returns The usage text for the command, or an empty string if\r\n   *   the command is not registered.\r\n   */\r\n  usage(id: string, args: ReadonlyPartialJSONObject = JSONExt.emptyObject): string {\r\n    let cmd = this._commands[id];\r\n    return cmd ? cmd.usage.call(undefined, args) : '';\r\n  }\r\n\r\n  /**\r\n   * Get the extra class name for a specific command.\r\n   *\r\n   * @param id - The id of the command of interest.\r\n   *\r\n   * @param args - The arguments for the command.\r\n   *\r\n   * @returns The class name for the command, or an empty string if\r\n   *   the command is not registered.\r\n   */\r\n  className(id: string, args: ReadonlyPartialJSONObject = JSONExt.emptyObject): string {\r\n    let cmd = this._commands[id];\r\n    return cmd ? cmd.className.call(undefined, args) : '';\r\n  }\r\n\r\n  /**\r\n   * Get the dataset for a specific command.\r\n   *\r\n   * @param id - The id of the command of interest.\r\n   *\r\n   * @param args - The arguments for the command.\r\n   *\r\n   * @returns The dataset for the command, or an empty dataset if\r\n   *   the command is not registered.\r\n   */\r\n  dataset(id: string, args: ReadonlyPartialJSONObject = JSONExt.emptyObject): CommandRegistry.Dataset {\r\n    let cmd = this._commands[id];\r\n    return cmd ? cmd.dataset.call(undefined, args) : {};\r\n  }\r\n\r\n  /**\r\n   * Test whether a specific command is enabled.\r\n   *\r\n   * @param id - The id of the command of interest.\r\n   *\r\n   * @param args - The arguments for the command.\r\n   *\r\n   * @returns A boolean indicating whether the command is enabled,\r\n   *   or `false` if the command is not registered.\r\n   */\r\n  isEnabled(id: string, args: ReadonlyPartialJSONObject = JSONExt.emptyObject): boolean {\r\n    let cmd = this._commands[id];\r\n    return cmd ? cmd.isEnabled.call(undefined, args) : false;\r\n  }\r\n\r\n  /**\r\n   * Test whether a specific command is toggled.\r\n   *\r\n   * @param id - The id of the command of interest.\r\n   *\r\n   * @param args - The arguments for the command.\r\n   *\r\n   * @returns A boolean indicating whether the command is toggled,\r\n   *   or `false` if the command is not registered.\r\n   */\r\n  isToggled(id: string, args: ReadonlyPartialJSONObject = JSONExt.emptyObject): boolean {\r\n    let cmd = this._commands[id];\r\n    return cmd ? cmd.isToggled.call(undefined, args) : false;\r\n  }\r\n\r\n  /**\r\n   * Test whether a specific command is toggleable.\r\n   *\r\n   * @param id - The id of the command of interest.\r\n   *\r\n   * @param args - The arguments for the command.\r\n   *\r\n   * @returns A boolean indicating whether the command is toggleable,\r\n   *   or `false` if the command is not registered.\r\n   */\r\n  isToggleable(id: string, args: ReadonlyJSONObject = JSONExt.emptyObject): boolean {\r\n    let cmd = this._commands[id];\r\n    return cmd ? cmd.isToggleable : false;\r\n  }\r\n\r\n  /**\r\n   * Test whether a specific command is visible.\r\n   *\r\n   * @param id - The id of the command of interest.\r\n   *\r\n   * @param args - The arguments for the command.\r\n   *\r\n   * @returns A boolean indicating whether the command is visible,\r\n   *   or `false` if the command is not registered.\r\n   */\r\n  isVisible(id: string, args: ReadonlyPartialJSONObject = JSONExt.emptyObject): boolean {\r\n    let cmd = this._commands[id];\r\n    return cmd ? cmd.isVisible.call(undefined, args) : false;\r\n  }\r\n\r\n  /**\r\n   * Execute a specific command.\r\n   *\r\n   * @param id - The id of the command of interest.\r\n   *\r\n   * @param args - The arguments for the command.\r\n   *\r\n   * @returns A promise which resolves with the result of the command.\r\n   *\r\n   * #### Notes\r\n   * The promise will reject if the command throws an exception,\r\n   * or if the command is not registered.\r\n   */\r\n  execute(id: string, args: ReadonlyPartialJSONObject = JSONExt.emptyObject): Promise<any> {\r\n    // Reject if the command is not registered.\r\n    let cmd = this._commands[id];\r\n    if (!cmd) {\r\n      return Promise.reject(new Error(`Command '${id}' not registered.`));\r\n    }\r\n\r\n    // Execute the command and reject if an exception is thrown.\r\n    let value: any;\r\n    try {\r\n      value = cmd.execute.call(undefined, args);\r\n    } catch (err) {\r\n      value = Promise.reject(err);\r\n    }\r\n\r\n    // Create the return promise which resolves the result.\r\n    let result = Promise.resolve(value);\r\n\r\n    // Emit the command executed signal.\r\n    this._commandExecuted.emit({ id, args, result });\r\n\r\n    // Return the result promise to the caller.\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Add a key binding to the registry.\r\n   *\r\n   * @param options - The options for creating the key binding.\r\n   *\r\n   * @returns A disposable which removes the added key binding.\r\n   *\r\n   * #### Notes\r\n   * If multiple key bindings are registered for the same sequence, the\r\n   * binding with the highest selector specificity is executed first. A\r\n   * tie is broken by using the most recently added key binding.\r\n   *\r\n   * Ambiguous key bindings are resolved with a timeout. As an example,\r\n   * suppose two key bindings are registered: one with the key sequence\r\n   * `['Ctrl D']`, and another with `['Ctrl D', 'Ctrl W']`. If the user\r\n   * presses `Ctrl D`, the first binding cannot be immediately executed\r\n   * since the user may intend to complete the chord with `Ctrl W`. For\r\n   * such cases, a timer is used to allow the chord to be completed. If\r\n   * the chord is not completed before the timeout, the first binding\r\n   * is executed.\r\n   */\r\n  addKeyBinding(options: CommandRegistry.IKeyBindingOptions): IDisposable {\r\n    // Create the binding for the given options.\r\n    let binding = Private.createKeyBinding(options);\r\n\r\n    // Add the key binding to the bindings array.\r\n    this._keyBindings.push(binding);\r\n\r\n    // Emit the `bindingChanged` signal.\r\n    this._keyBindingChanged.emit({ binding, type: 'added' });\r\n\r\n    // Return a disposable which will remove the binding.\r\n    return new DisposableDelegate(() => {\r\n      // Remove the binding from the array.\r\n      ArrayExt.removeFirstOf(this._keyBindings, binding);\r\n\r\n      // Emit the `bindingChanged` signal.\r\n      this._keyBindingChanged.emit({ binding, type: 'removed' });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Process a `'keydown'` event and invoke a matching key binding.\r\n   *\r\n   * @param event - The event object for a `'keydown'` event.\r\n   *\r\n   * #### Notes\r\n   * This should be called in response to a `'keydown'` event in order\r\n   * to invoke the command for the best matching key binding.\r\n   *\r\n   * The registry **does not** install its own listener for `'keydown'`\r\n   * events. This allows the application full control over the nodes\r\n   * and phase for which the registry processes `'keydown'` events.\r\n   *\r\n   * When the keydown event is processed, if the event target or any of its\r\n   * ancestor nodes has a `data-lm-suppress-shortcuts` attribute, its keydown\r\n   * events will not invoke commands.\r\n   */\r\n  processKeydownEvent(event: KeyboardEvent): void {\r\n    // Bail immediately if playing back keystrokes.\r\n    if (this._replaying) {\r\n      return;\r\n    }\r\n\r\n    // Get the normalized keystroke for the event.\r\n    let keystroke = CommandRegistry.keystrokeForKeydownEvent(event);\r\n\r\n    // If the keystroke is not valid for the keyboard layout, replay\r\n    // any suppressed events and clear the pending state.\r\n    if (!keystroke) {\r\n      this._replayKeydownEvents();\r\n      this._clearPendingState();\r\n      return;\r\n    }\r\n\r\n    // Add the keystroke to the current key sequence.\r\n    this._keystrokes.push(keystroke);\r\n\r\n    // Find the exact and partial matches for the key sequence.\r\n    let { exact, partial } = Private.matchKeyBinding(\r\n      this._keyBindings, this._keystrokes, event\r\n    );\r\n\r\n    // If there is no exact match and no partial match, replay\r\n    // any suppressed events and clear the pending state.\r\n    if (!exact && !partial) {\r\n      this._replayKeydownEvents();\r\n      this._clearPendingState();\r\n      return;\r\n    }\r\n\r\n    // Stop propagation of the event. If there is only a partial match,\r\n    // the event will be replayed if a final exact match never occurs.\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n\r\n    // If there is an exact match but no partial match, the exact match\r\n    // can be dispatched immediately. The pending state is cleared so\r\n    // the next key press starts from the default state.\r\n    if (exact && !partial) {\r\n      this._executeKeyBinding(exact);\r\n      this._clearPendingState();\r\n      return;\r\n    }\r\n\r\n    // If there is both an exact match and a partial match, the exact\r\n    // match is stored for future dispatch in case the timer expires\r\n    // before a more specific match is triggered.\r\n    if (exact) {\r\n      this._exactKeyMatch = exact;\r\n    }\r\n\r\n    // Store the event for possible playback in the future.\r\n    this._keydownEvents.push(event);\r\n\r\n    // (Re)start the timer to dispatch the most recent exact match\r\n    // in case the partial match fails to result in an exact match.\r\n    this._startTimer();\r\n  }\r\n\r\n  /**\r\n   * Start or restart the pending timeout.\r\n   */\r\n  private _startTimer(): void {\r\n    this._clearTimer();\r\n    this._timerID = window.setTimeout(() => {\r\n      this._onPendingTimeout();\r\n    }, Private.CHORD_TIMEOUT);\r\n  }\r\n\r\n  /**\r\n   * Clear the pending timeout.\r\n   */\r\n  private _clearTimer(): void {\r\n    if (this._timerID !== 0) {\r\n      clearTimeout(this._timerID);\r\n      this._timerID = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Replay the keydown events which were suppressed.\r\n   */\r\n  private _replayKeydownEvents(): void {\r\n    if (this._keydownEvents.length === 0) {\r\n      return;\r\n    }\r\n    this._replaying = true;\r\n    this._keydownEvents.forEach(Private.replayKeyEvent);\r\n    this._replaying = false;\r\n  }\r\n\r\n  /**\r\n   * Execute the command for the given key binding.\r\n   *\r\n   * If the command is missing or disabled, a warning will be logged.\r\n   */\r\n  private _executeKeyBinding(binding: CommandRegistry.IKeyBinding): void {\r\n    let { command, args } = binding;\r\n    if (!this.hasCommand(command) || !this.isEnabled(command, args)) {\r\n      let word = this.hasCommand(command) ? 'enabled' : 'registered';\r\n      let keys = binding.keys.join(', ');\r\n      let msg1 = `Cannot execute key binding '${keys}':`;\r\n      let msg2 = `command '${command}' is not ${word}.`;\r\n      console.warn(`${msg1} ${msg2}`);\r\n      return;\r\n    }\r\n    this.execute(command, args);\r\n  }\r\n\r\n  /**\r\n   * Clear the internal pending state.\r\n   */\r\n  private _clearPendingState(): void {\r\n    this._clearTimer();\r\n    this._exactKeyMatch = null;\r\n    this._keystrokes.length = 0;\r\n    this._keydownEvents.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Handle the partial match timeout.\r\n   */\r\n  private _onPendingTimeout(): void {\r\n    this._timerID = 0;\r\n    if (this._exactKeyMatch) {\r\n      this._executeKeyBinding(this._exactKeyMatch);\r\n    } else {\r\n      this._replayKeydownEvents();\r\n    }\r\n    this._clearPendingState();\r\n  }\r\n\r\n  private _timerID = 0;\r\n  private _replaying = false;\r\n  private _keystrokes: string[] = [];\r\n  private _keydownEvents: KeyboardEvent[] = [];\r\n  private _keyBindings: CommandRegistry.IKeyBinding[] = [];\r\n  private _exactKeyMatch: CommandRegistry.IKeyBinding | null = null;\r\n  private _commands: { [id: string]: Private.ICommand } = Object.create(null);\r\n  private _commandChanged = new Signal<this, CommandRegistry.ICommandChangedArgs>(this);\r\n  private _commandExecuted = new Signal<this, CommandRegistry.ICommandExecutedArgs>(this);\r\n  private _keyBindingChanged = new Signal<this, CommandRegistry.IKeyBindingChangedArgs>(this);\r\n}\r\n\r\n\r\n/**\r\n * The namespace for the `CommandRegistry` class statics.\r\n */\r\nexport\r\nnamespace CommandRegistry {\r\n  /**\r\n   * A type alias for a user-defined command function.\r\n   */\r\n  export\r\n  type CommandFunc<T> = (args: ReadonlyPartialJSONObject) => T;\r\n\r\n  /**\r\n   * A type alias for a simple immutable string dataset.\r\n   */\r\n  export\r\n  type Dataset = { readonly [key: string]: string };\r\n\r\n  /**\r\n   * An options object for creating a command.\r\n   *\r\n   * #### Notes\r\n   * A command is an abstract representation of code to be executed along\r\n   * with metadata for describing how the command should be displayed in\r\n   * a visual representation.\r\n   *\r\n   * A command is a collection of functions, *not* methods. The command\r\n   * registry will always invoke the command functions with a `thisArg`\r\n   * which is `undefined`.\r\n   */\r\n  export\r\n  interface ICommandOptions {\r\n    /**\r\n     * The function to invoke when the command is executed.\r\n     *\r\n     * #### Notes\r\n     * This should return the result of the command (if applicable) or\r\n     * a promise which yields the result. The result is resolved as a\r\n     * promise and that promise is returned to the code which executed\r\n     * the command.\r\n     *\r\n     * This may be invoked even when `isEnabled` returns `false`.\r\n     */\r\n    execute: CommandFunc<any | Promise<any>>;\r\n\r\n    /**\r\n     * The label for the command.\r\n     *\r\n     * #### Notes\r\n     * This can be a string literal, or a function which returns the\r\n     * label based on the provided command arguments.\r\n     *\r\n     * The label is often used as the primary text for the command.\r\n     *\r\n     * The default value is an empty string.\r\n     */\r\n    label?: string | CommandFunc<string>;\r\n\r\n    /**\r\n     * The index of the mnemonic character in the command's label.\r\n     *\r\n     * #### Notes\r\n     * This can be an index literal, or a function which returns the\r\n     * mnemonic index based on the provided command arguments.\r\n     *\r\n     * The mnemonic character is often used by menus to provide easy\r\n     * single-key keyboard access for triggering a menu item. It is\r\n     * typically rendered as an underlined character in the label.\r\n     *\r\n     * The default value is `-1`.\r\n     */\r\n    mnemonic?: number | CommandFunc<number>;\r\n\r\n    /**\r\n     * The icon renderer for the command.\r\n     *\r\n     * #### Notes\r\n     * This can be an IRenderer object, or a function which returns the\r\n     * renderer based on the provided command arguments.\r\n     *\r\n     * The default value is undefined.\r\n     * \r\n     * DEPRECATED: if set to a string value, the .icon field will function as\r\n     * an alias for the .iconClass field, for backwards compatibility\r\n     */\r\n    icon?: VirtualElement.IRenderer | undefined\r\n    /* <DEPRECATED> */ | string /* </DEPRECATED> */\r\n    | CommandFunc<\r\n      VirtualElement.IRenderer | undefined\r\n      /* <DEPRECATED> */ | string /* </DEPRECATED> */\r\n    >;\r\n    \r\n    /**\r\n     * The icon class for the command.\r\n     *\r\n     * #### Notes\r\n     * This class name will be added to the icon node for the visual\r\n     * representation of the command.\r\n     *\r\n     * Multiple class names can be separated with white space.\r\n     *\r\n     * This can be a string literal, or a function which returns the\r\n     * icon based on the provided command arguments.\r\n     *\r\n     * The default value is an empty string.\r\n     */\r\n    iconClass?: string | CommandFunc<string>;\r\n\r\n    /**\r\n     * The icon label for the command.\r\n     *\r\n     * #### Notes\r\n     * This label will be added as text to the icon node for the visual\r\n     * representation of the command.\r\n     *\r\n     * This can be a string literal, or a function which returns the\r\n     * label based on the provided command arguments.\r\n     *\r\n     * The default value is an empty string.\r\n     */\r\n    iconLabel?: string | CommandFunc<string>;\r\n\r\n    /**\r\n     * The caption for the command.\r\n     *\r\n     * #### Notes\r\n     * This should be a simple one line description of the command. It\r\n     * is used by some visual representations to show quick info about\r\n     * the command.\r\n     *\r\n     * This can be a string literal, or a function which returns the\r\n     * caption based on the provided command arguments.\r\n     *\r\n     * The default value is an empty string.\r\n     */\r\n    caption?: string | CommandFunc<string>;\r\n\r\n    /**\r\n     * The usage text for the command.\r\n     *\r\n     * #### Notes\r\n     * This should be a full description of the command, which includes\r\n     * information about the structure of the arguments and the type of\r\n     * the return value. It is used by some visual representations when\r\n     * displaying complete help info about the command.\r\n     *\r\n     * This can be a string literal, or a function which returns the\r\n     * usage text based on the provided command arguments.\r\n     *\r\n     * The default value is an empty string.\r\n     */\r\n    usage?: string | CommandFunc<string>;\r\n\r\n    /**\r\n     * The general class name for the command.\r\n     *\r\n     * #### Notes\r\n     * This class name will be added to the primary node for the visual\r\n     * representation of the command.\r\n     *\r\n     * Multiple class names can be separated with white space.\r\n     *\r\n     * This can be a string literal, or a function which returns the\r\n     * class name based on the provided command arguments.\r\n     *\r\n     * The default value is an empty string.\r\n     */\r\n    className?: string | CommandFunc<string>;\r\n\r\n    /**\r\n     * The dataset for the command.\r\n     *\r\n     * #### Notes\r\n     * The dataset values will be added to the primary node for the\r\n     * visual representation of the command.\r\n     *\r\n     * This can be a dataset object, or a function which returns the\r\n     * dataset object based on the provided command arguments.\r\n     *\r\n     * The default value is an empty dataset.\r\n     */\r\n    dataset?: Dataset | CommandFunc<Dataset>;\r\n\r\n    /**\r\n     * A function which indicates whether the command is enabled.\r\n     *\r\n     * #### Notes\r\n     * Visual representations may use this value to display a disabled\r\n     * command as grayed-out or in some other non-interactive fashion.\r\n     *\r\n     * The default value is `() => true`.\r\n     */\r\n    isEnabled?: CommandFunc<boolean>;\r\n\r\n    /**\r\n     * A function which indicates whether the command is toggled.\r\n     *\r\n     * #### Notes\r\n     * Visual representations may use this value to display a toggled\r\n     * command in a different form, such as a check mark icon for a\r\n     * menu item or a depressed state for a toggle button.\r\n     *\r\n     * The default value is `() => false`.\r\n     */\r\n    isToggled?: CommandFunc<boolean>;\r\n\r\n    /**\r\n     * A function which indicates whether the command is toggleable.\r\n     *\r\n     * #### Notes\r\n     * Visual representations may use this value to display a toggled command in\r\n     * a different form, such as a check box for a menu item or a depressed\r\n     * state for a toggle button. This attribute also allows for accessible\r\n     * interfaces to notify the user that the command corresponds to some state.\r\n     *\r\n     * The default value is `true` if an `isToggled` function is given, `false`\r\n     * otherwise.\r\n     */\r\n    isToggleable?: boolean;\r\n\r\n    /**\r\n     * A function which indicates whether the command is visible.\r\n     *\r\n     * #### Notes\r\n     * Visual representations may use this value to hide or otherwise\r\n     * not display a non-visible command.\r\n     *\r\n     * The default value is `() => true`.\r\n     */\r\n    isVisible?: CommandFunc<boolean>;\r\n  }\r\n\r\n  /**\r\n   * An arguments object for the `commandChanged` signal.\r\n   */\r\n  export\r\n  interface ICommandChangedArgs {\r\n    /**\r\n     * The id of the associated command.\r\n     *\r\n     * This will be `undefined` when the type is `'many-changed'`.\r\n     */\r\n    readonly id: string | undefined;\r\n\r\n    /**\r\n     * Whether the command was added, removed, or changed.\r\n     */\r\n    readonly type: 'added' | 'removed' | 'changed' | 'many-changed';\r\n  }\r\n\r\n  /**\r\n   * An arguments object for the `commandExecuted` signal.\r\n   */\r\n  export\r\n  interface ICommandExecutedArgs {\r\n    /**\r\n     * The id of the associated command.\r\n     */\r\n    readonly id: string;\r\n\r\n    /**\r\n     * The arguments object passed to the command.\r\n     */\r\n    readonly args: ReadonlyPartialJSONObject;\r\n\r\n    /**\r\n     * The promise which resolves with the result of the command.\r\n     */\r\n    readonly result: Promise<any>;\r\n  }\r\n\r\n  /**\r\n   * An options object for creating a key binding.\r\n   */\r\n  export\r\n  interface IKeyBindingOptions {\r\n    /**\r\n     * The default key sequence for the key binding.\r\n     *\r\n     * A key sequence is composed of one or more keystrokes, where each\r\n     * keystroke is a combination of modifiers and a primary key.\r\n     *\r\n     * Most key sequences will contain a single keystroke. Key sequences\r\n     * with multiple keystrokes are called \"chords\", and are useful for\r\n     * implementing modal input (ala Vim).\r\n     *\r\n     * Each keystroke in the sequence should be of the form:\r\n     *   `[<modifier 1> [<modifier 2> [<modifier N> ]]]<primary key>`\r\n     *\r\n     * The supported modifiers are: `Accel`, `Alt`, `Cmd`, `Ctrl`, and\r\n     * `Shift`. The `Accel` modifier is translated to `Cmd` on Mac and\r\n     * `Ctrl` on all other platforms. The `Cmd` modifier is ignored on\r\n     * non-Mac platforms.\r\n     *\r\n     * Keystrokes are case sensitive.\r\n     *\r\n     * **Examples:** `['Accel C']`, `['Shift F11']`, `['D', 'D']`\r\n     */\r\n    keys: string[];\r\n\r\n    /**\r\n     * The CSS selector for the key binding.\r\n     *\r\n     * The key binding will only be invoked when the selector matches a\r\n     * node on the propagation path of the keydown event. This allows\r\n     * the key binding to be restricted to user-defined contexts.\r\n     *\r\n     * The selector must not contain commas.\r\n     */\r\n    selector: string;\r\n\r\n    /**\r\n     * The id of the command to execute when the binding is matched.\r\n     */\r\n    command: string;\r\n\r\n    /**\r\n     * The arguments for the command, if necessary.\r\n     *\r\n     * The default value is an empty object.\r\n     */\r\n    args?: ReadonlyPartialJSONObject;\r\n\r\n    /**\r\n     * The key sequence to use when running on Windows.\r\n     *\r\n     * If provided, this will override `keys` on Windows platforms.\r\n     */\r\n    winKeys?: string[];\r\n\r\n    /**\r\n     * The key sequence to use when running on Mac.\r\n     *\r\n     * If provided, this will override `keys` on Mac platforms.\r\n     */\r\n    macKeys?: string[];\r\n\r\n    /**\r\n     * The key sequence to use when running on Linux.\r\n     *\r\n     * If provided, this will override `keys` on Linux platforms.\r\n     */\r\n    linuxKeys?: string[];\r\n  }\r\n\r\n  /**\r\n   * An object which represents a key binding.\r\n   *\r\n   * #### Notes\r\n   * A key binding is an immutable object created by a registry.\r\n   */\r\n  export\r\n  interface IKeyBinding {\r\n    /**\r\n     * The key sequence for the binding.\r\n     */\r\n    readonly keys: ReadonlyArray<string>;\r\n\r\n    /**\r\n     * The CSS selector for the binding.\r\n     */\r\n    readonly selector: string;\r\n\r\n    /**\r\n     * The command executed when the binding is matched.\r\n     */\r\n    readonly command: string;\r\n\r\n    /**\r\n     * The arguments for the command.\r\n     */\r\n    readonly args: ReadonlyPartialJSONObject;\r\n  }\r\n\r\n  /**\r\n   * An arguments object for the `keyBindingChanged` signal.\r\n   */\r\n  export\r\n  interface IKeyBindingChangedArgs {\r\n    /**\r\n     * The key binding which was changed.\r\n     */\r\n    readonly binding: IKeyBinding;\r\n\r\n    /**\r\n     * Whether the key binding was added or removed.\r\n     */\r\n    readonly type: 'added' | 'removed';\r\n  }\r\n\r\n  /**\r\n   * An object which holds the results of parsing a keystroke.\r\n   */\r\n  export\r\n  interface IKeystrokeParts {\r\n    /**\r\n     * Whether `'Cmd'` appears in the keystroke.\r\n     */\r\n    cmd: boolean;\r\n\r\n    /**\r\n     * Whether `'Ctrl'` appears in the keystroke.\r\n     */\r\n    ctrl: boolean;\r\n\r\n    /**\r\n     * Whether `'Alt'` appears in the keystroke.\r\n     */\r\n    alt: boolean;\r\n\r\n    /**\r\n     * Whether `'Shift'` appears in the keystroke.\r\n     */\r\n    shift: boolean;\r\n\r\n    /**\r\n     * The primary key for the keystroke.\r\n     */\r\n    key: string;\r\n  }\r\n\r\n  /**\r\n   * Parse a keystroke into its constituent components.\r\n   *\r\n   * @param keystroke - The keystroke of interest.\r\n   *\r\n   * @returns The parsed components of the keystroke.\r\n   *\r\n   * #### Notes\r\n   * The keystroke should be of the form:\r\n   *   `[<modifier 1> [<modifier 2> [<modifier N> ]]]<primary key>`\r\n   *\r\n   * The supported modifiers are: `Accel`, `Alt`, `Cmd`, `Ctrl`, and\r\n   * `Shift`. The `Accel` modifier is translated to `Cmd` on Mac and\r\n   * `Ctrl` on all other platforms.\r\n   *\r\n   * The parsing is tolerant and will not throw exceptions. Notably:\r\n   *   - Duplicate modifiers are ignored.\r\n   *   - Extra primary keys are ignored.\r\n   *   - The order of modifiers and primary key is irrelevant.\r\n   *   - The keystroke parts should be separated by whitespace.\r\n   *   - The keystroke is case sensitive.\r\n   */\r\n  export\r\n  function parseKeystroke(keystroke: string): IKeystrokeParts {\r\n    let key = '';\r\n    let alt = false;\r\n    let cmd = false;\r\n    let ctrl = false;\r\n    let shift = false;\r\n    for (let token of keystroke.split(/\\s+/)) {\r\n      if (token === 'Accel') {\r\n        if (Platform.IS_MAC) {\r\n          cmd = true;\r\n        } else {\r\n          ctrl = true;\r\n        }\r\n      } else if (token === 'Alt') {\r\n        alt = true;\r\n      } else if (token === 'Cmd') {\r\n        cmd = true;\r\n      } else if (token === 'Ctrl') {\r\n        ctrl = true;\r\n      } else if (token === 'Shift') {\r\n        shift = true;\r\n      } else if (token.length > 0) {\r\n        key = token;\r\n      }\r\n    }\r\n    return { cmd, ctrl, alt, shift, key };\r\n  }\r\n\r\n  /**\r\n   * Normalize a keystroke into a canonical representation.\r\n   *\r\n   * @param keystroke - The keystroke of interest.\r\n   *\r\n   * @returns The normalized representation of the keystroke.\r\n   *\r\n   * #### Notes\r\n   * This normalizes the keystroke by removing duplicate modifiers and\r\n   * extra primary keys, and assembling the parts in a canonical order.\r\n   *\r\n   * The `Cmd` modifier is ignored on non-Mac platforms.\r\n   */\r\n  export\r\n  function normalizeKeystroke(keystroke: string): string {\r\n    let mods = '';\r\n    let parts = parseKeystroke(keystroke);\r\n    if (parts.ctrl) {\r\n      mods += 'Ctrl ';\r\n    }\r\n    if (parts.alt) {\r\n      mods += 'Alt ';\r\n    }\r\n    if (parts.shift) {\r\n      mods += 'Shift ';\r\n    }\r\n    if (parts.cmd && Platform.IS_MAC) {\r\n      mods += 'Cmd ';\r\n    }\r\n    return mods + parts.key;\r\n  }\r\n\r\n  /**\r\n   * Get the platform-specific normalized keys for an options object.\r\n   *\r\n   * @param options - The options for the key binding.\r\n   *\r\n   * @returns Array of combined, normalized keys.\r\n   */\r\n  export\r\n  function normalizeKeys(options: IKeyBindingOptions): string[] {\r\n    let keys: string[];\r\n    if (Platform.IS_WIN) {\r\n      keys = options.winKeys || options.keys;\r\n    } else if (Platform.IS_MAC) {\r\n      keys = options.macKeys || options.keys;\r\n    } else {\r\n      keys = options.linuxKeys || options.keys;\r\n    }\r\n    return keys.map(normalizeKeystroke);\r\n  }\r\n\r\n  /**\r\n   * Format a keystroke for display on the local system.\r\n   */\r\n  export\r\n  function formatKeystroke(keystroke: string): string {\r\n    let mods = '';\r\n    let parts = parseKeystroke(keystroke);\r\n    if (Platform.IS_MAC) {\r\n      if (parts.ctrl) {\r\n        mods += '\\u2303 ';\r\n      }\r\n      if (parts.alt) {\r\n        mods += '\\u2325 ';\r\n      }\r\n      if (parts.shift) {\r\n        mods += '\\u21E7 ';\r\n      }\r\n      if (parts.cmd) {\r\n        mods += '\\u2318 ';\r\n      }\r\n    } else {\r\n      if (parts.ctrl) {\r\n        mods += 'Ctrl+';\r\n      }\r\n      if (parts.alt) {\r\n        mods += 'Alt+';\r\n      }\r\n      if (parts.shift) {\r\n        mods += 'Shift+';\r\n      }\r\n    }\r\n    return mods + parts.key;\r\n  }\r\n\r\n  /**\r\n   * Create a normalized keystroke for a `'keydown'` event.\r\n   *\r\n   * @param event - The event object for a `'keydown'` event.\r\n   *\r\n   * @returns A normalized keystroke, or an empty string if the event\r\n   *   does not represent a valid keystroke for the given layout.\r\n   */\r\n  export\r\n  function keystrokeForKeydownEvent(event: KeyboardEvent): string {\r\n    let key = getKeyboardLayout().keyForKeydownEvent(event);\r\n    if (!key) {\r\n      return '';\r\n    }\r\n    let mods = '';\r\n    if (event.ctrlKey) {\r\n      mods += 'Ctrl ';\r\n    }\r\n    if (event.altKey) {\r\n      mods += 'Alt ';\r\n    }\r\n    if (event.shiftKey) {\r\n      mods += 'Shift ';\r\n    }\r\n    if (event.metaKey && Platform.IS_MAC) {\r\n      mods += 'Cmd ';\r\n    }\r\n    return mods + key;\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * The namespace for the module implementation details.\r\n */\r\nnamespace Private {\r\n  /**\r\n   * The timeout in ms for triggering a key binding chord.\r\n   */\r\n  export\r\n  const CHORD_TIMEOUT = 1000;\r\n\r\n  /**\r\n   * A convenience type alias for a command func.\r\n   */\r\n  export\r\n  type CommandFunc<T> = CommandRegistry.CommandFunc<T>;\r\n\r\n  /**\r\n   * A convenience type alias for a command dataset.\r\n   */\r\n  export\r\n  type Dataset = CommandRegistry.Dataset;\r\n\r\n  /**\r\n   * A normalized command object.\r\n   */\r\n  export\r\n  interface ICommand {\r\n    readonly execute: CommandFunc<any>;\r\n    readonly label: CommandFunc<string>;\r\n    readonly mnemonic: CommandFunc<number>;\r\n    \r\n    readonly icon: CommandFunc<\r\n      VirtualElement.IRenderer | undefined\r\n      /* <DEPRECATED> */ | string /* </DEPRECATED> */\r\n    >;\r\n    \r\n    readonly iconClass: CommandFunc<string>;\r\n    readonly iconLabel: CommandFunc<string>;\r\n    readonly caption: CommandFunc<string>;\r\n    readonly usage: CommandFunc<string>;\r\n    readonly className: CommandFunc<string>;\r\n    readonly dataset: CommandFunc<Dataset>;\r\n    readonly isEnabled: CommandFunc<boolean>;\r\n    readonly isToggled: CommandFunc<boolean>;\r\n    readonly isToggleable: boolean;\r\n    readonly isVisible: CommandFunc<boolean>;\r\n  }\r\n\r\n  /**\r\n   * Create a normalized command from an options object.\r\n   */\r\n  export\r\n  function createCommand(options: CommandRegistry.ICommandOptions): ICommand {\r\n    let icon;\r\n    let iconClass;\r\n    \r\n    /* <DEPRECATED> */\r\n    if (!(options.icon) || typeof options.icon === 'string') {\r\n      // alias icon to iconClass\r\n      iconClass = asFunc(options.iconClass || options.icon, emptyStringFunc);\r\n      icon = iconClass;\r\n    } else {\r\n    /* /<DEPRECATED> */\r\n\r\n    iconClass = asFunc(options.iconClass, emptyStringFunc);\r\n    icon = asFunc(options.icon, undefinedFunc);\r\n\r\n    /* <DEPRECATED> */\r\n    }\r\n    /* </DEPRECATED> */\r\n    \r\n    return {\r\n      execute: options.execute,\r\n      label: asFunc(options.label, emptyStringFunc),\r\n      mnemonic: asFunc(options.mnemonic, negativeOneFunc),\r\n      icon,\r\n      iconClass,\r\n      iconLabel: asFunc(options.iconLabel, emptyStringFunc),\r\n      caption: asFunc(options.caption, emptyStringFunc),\r\n      usage: asFunc(options.usage, emptyStringFunc),\r\n      className: asFunc(options.className, emptyStringFunc),\r\n      dataset: asFunc(options.dataset, emptyDatasetFunc),\r\n      isEnabled: options.isEnabled || trueFunc,\r\n      isToggled: options.isToggled || falseFunc,\r\n      isToggleable: options.isToggleable || !!options.isToggled,\r\n      isVisible: options.isVisible || trueFunc\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Create a key binding object from key binding options.\r\n   */\r\n  export\r\n  function createKeyBinding(options: CommandRegistry.IKeyBindingOptions): CommandRegistry.IKeyBinding {\r\n    return {\r\n      keys: CommandRegistry.normalizeKeys(options),\r\n      selector: validateSelector(options),\r\n      command: options.command,\r\n      args: options.args || JSONExt.emptyObject\r\n    };\r\n  }\r\n\r\n  /**\r\n   * An object which holds the results of a key binding match.\r\n   */\r\n  export\r\n  interface IMatchResult {\r\n    /**\r\n     * The best key binding which exactly matches the key sequence.\r\n     */\r\n    exact: CommandRegistry.IKeyBinding | null;\r\n\r\n    /**\r\n     * Whether there are bindings which partially match the sequence.\r\n     */\r\n    partial: boolean;\r\n  }\r\n\r\n  /**\r\n   * Find the key bindings which match a key sequence.\r\n   *\r\n   * This returns a match result which contains the best exact matching\r\n   * binding, and a flag which indicates if there are partial matches.\r\n   */\r\n  export\r\n  function matchKeyBinding(bindings: ReadonlyArray<CommandRegistry.IKeyBinding>, keys: ReadonlyArray<string>, event: KeyboardEvent): IMatchResult {\r\n    // The current best exact match.\r\n    let exact: CommandRegistry.IKeyBinding | null = null;\r\n\r\n    // Whether a partial match has been found.\r\n    let partial = false;\r\n\r\n    // The match distance for the exact match.\r\n    let distance = Infinity;\r\n\r\n    // The specificity for the exact match.\r\n    let specificity = 0;\r\n\r\n    // Iterate over the bindings and search for the best match.\r\n    for (let i = 0, n = bindings.length; i < n; ++i) {\r\n      // Lookup the current binding.\r\n      let binding = bindings[i];\r\n\r\n      // Check whether the key binding sequence is a match.\r\n      let sqm = matchSequence(binding.keys, keys);\r\n\r\n      // If there is no match, the binding is ignored.\r\n      if (sqm === SequenceMatch.None) {\r\n        continue;\r\n      }\r\n\r\n      // If it is a partial match and no other partial match has been\r\n      // found, ensure the selector matches and set the partial flag.\r\n      if (sqm === SequenceMatch.Partial) {\r\n        if (!partial && targetDistance(binding.selector, event) !== -1) {\r\n          partial = true;\r\n        }\r\n        continue;\r\n      }\r\n\r\n      // Ignore the match if the selector doesn't match, or if the\r\n      // matched node is farther away than the current best match.\r\n      let td = targetDistance(binding.selector, event);\r\n      if (td === -1 || td > distance) {\r\n        continue;\r\n      }\r\n\r\n      // Get the specificity for the selector.\r\n      let sp = Selector.calculateSpecificity(binding.selector);\r\n\r\n      // Update the best match if this match is stronger.\r\n      if (!exact || td < distance || sp >= specificity) {\r\n        exact = binding;\r\n        distance = td;\r\n        specificity = sp;\r\n      }\r\n    }\r\n\r\n    // Return the match result.\r\n    return { exact, partial };\r\n  }\r\n\r\n  /**\r\n   * Replay a keyboard event.\r\n   *\r\n   * This synthetically dispatches a clone of the keyboard event.\r\n   */\r\n  export\r\n  function replayKeyEvent(event: KeyboardEvent): void {\r\n    event.target!.dispatchEvent(cloneKeyboardEvent(event));\r\n  }\r\n\r\n  /**\r\n   * A singleton empty string function.\r\n   */\r\n  const emptyStringFunc = () => '';\r\n\r\n  /**\r\n   * A singleton `-1` number function\r\n   */\r\n  const negativeOneFunc = () => -1;\r\n\r\n  /**\r\n   * A singleton true boolean function.\r\n   */\r\n  const trueFunc = () => true;\r\n\r\n  /**\r\n   * A singleton false boolean function.\r\n   */\r\n  const falseFunc = () => false;\r\n\r\n  /**\r\n   * A singleton empty dataset function.\r\n   */\r\n  const emptyDatasetFunc = () => ({});\r\n\r\n  /**\r\n   * A singleton undefined function\r\n   */\r\n  const undefinedFunc = () => undefined;\r\n\r\n  /**\r\n   * Cast a value or command func to a command func.\r\n   */\r\n  function asFunc<T>(value: undefined | T | CommandFunc<T>, dfault: CommandFunc<T>): CommandFunc<T> {\r\n    if (value === undefined) {\r\n      return dfault;\r\n    }\r\n    if (typeof value === 'function') {\r\n      return value as CommandFunc<T>;\r\n    }\r\n    return () => value;\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Validate the selector for an options object.\r\n   *\r\n   * This returns the validated selector, or throws if the selector is\r\n   * invalid or contains commas.\r\n   */\r\n  function validateSelector(options: CommandRegistry.IKeyBindingOptions): string {\r\n    if (options.selector.indexOf(',') !== -1) {\r\n      throw new Error(`Selector cannot contain commas: ${options.selector}`);\r\n    }\r\n    if (!Selector.isValid(options.selector)) {\r\n      throw new Error(`Invalid selector: ${options.selector}`);\r\n    }\r\n    return options.selector;\r\n  }\r\n\r\n  /**\r\n   * An enum which describes the possible sequence matches.\r\n   */\r\n  const enum SequenceMatch { None, Exact, Partial };\r\n\r\n  /**\r\n   * Test whether a key binding sequence matches a key sequence.\r\n   *\r\n   * Returns a `SequenceMatch` value indicating the type of match.\r\n   */\r\n  function matchSequence(bindKeys: ReadonlyArray<string>, userKeys: ReadonlyArray<string>): SequenceMatch {\r\n    if (bindKeys.length < userKeys.length) {\r\n      return SequenceMatch.None;\r\n    }\r\n    for (let i = 0, n = userKeys.length; i < n; ++i) {\r\n      if (bindKeys[i] !== userKeys[i]) {\r\n        return SequenceMatch.None;\r\n      }\r\n    }\r\n    if (bindKeys.length > userKeys.length) {\r\n      return SequenceMatch.Partial;\r\n    }\r\n    return SequenceMatch.Exact;\r\n  }\r\n\r\n  /**\r\n   * Find the distance from the target node to the first matching node.\r\n   *\r\n   * This traverses the event path from `target` to `currentTarget` and\r\n   * computes the distance from `target` to the first node which matches\r\n   * the CSS selector. If no match is found, `-1` is returned.\r\n   */\r\n  function targetDistance(selector: string, event: KeyboardEvent): number {\r\n    let targ = event.target as (Element | null);\r\n    let curr = event.currentTarget as (Element | null);\r\n    for (let dist = 0; targ !== null; targ = targ.parentElement, ++dist) {\r\n      if (targ.hasAttribute('data-lm-suppress-shortcuts')) {\r\n        return -1;\r\n      }\r\n      /* <DEPRECATED> */\r\n      if (targ.hasAttribute('data-p-suppress-shortcuts')) {\r\n        return -1;\r\n      }\r\n      /* </DEPRECATED> */\r\n      if (Selector.matches(targ, selector)) {\r\n        return dist;\r\n      }\r\n      if (targ === curr) {\r\n        return -1;\r\n      }\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  /**\r\n   * Clone a keyboard event.\r\n   */\r\n  function cloneKeyboardEvent(event: KeyboardEvent): KeyboardEvent {\r\n    // A custom event is required because Chrome nulls out the\r\n    // `keyCode` field in user-generated `KeyboardEvent` types.\r\n    let clone = document.createEvent('Event') as any;\r\n    let bubbles = event.bubbles || true;\r\n    let cancelable = event.cancelable || true;\r\n    clone.initEvent(event.type || 'keydown', bubbles, cancelable);\r\n    clone.key = event.key || '';\r\n    clone.keyCode = event.keyCode || 0;\r\n    clone.which = event.keyCode || 0;\r\n    clone.ctrlKey = event.ctrlKey || false;\r\n    clone.altKey = event.altKey || false;\r\n    clone.shiftKey = event.shiftKey || false;\r\n    clone.metaKey = event.metaKey || false;\r\n    clone.view = event.view || window;\r\n    return clone as KeyboardEvent;\r\n  }\r\n}\r\n"],"names":["Signal","DisposableDelegate","JSONExt","ArrayExt","Platform","getKeyboardLayout","CommandRegistry","Selector"],"mappings":"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"}